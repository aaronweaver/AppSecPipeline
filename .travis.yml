sudo: required
language: python
install: true

services:
  - docker

env:
  global:
    - VERSION=1.${TRAVIS_BUILD_NUMBER}
  matrix:
    - PIPELINE_BUILD='basetools'
      DOCKER_FILE='base/dockerfile-base-tools'
      REPO='appsecpipeline/base-tools'
    - PIPELINE_BUILD=sast
      DOCKER_FILE='base/dockerfile-sast'
      REPO='appsecpipeline/base-tools'
    - PIPELINE_BUILD=node
      DOCKER_FILE='base/dockerfile-node'
      REPO='appsecpipeline/node'
    - PIPELINE_BUILD=ruby
      DOCKER_FILE='base/dockerfile-ruby'
      REPO='appsecpipeline/ruby'
    - PIPELINE_BUILD=zap
      DOCKER_FILE='base/dockerfile-zap'
      REPO='appsecpipeline/node'

before_script:
  - export REPO='appsecpipeline/base'
  - docker build -f dockers/base/dockerfile-base . -t $REPO
  - bash build/docker-hub.sh $TRAVIS_BRANCH $REPO $VERSION

script:
  - |
    echo "Running PipelineBuild=$PIPELINE_BUILD"
    docker build -f dockers/$DOCKER_FILE . -t $REPO
    bash build/docker-hub.sh $TRAVIS_BRANCH $REPO $VERSION
